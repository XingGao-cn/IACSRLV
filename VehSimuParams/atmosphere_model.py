# æ¨ç‚³å°‰æ°”æ¨¡å‹
#      å…¬å¼è®¡ç®—å€¼ä¸åŸè¡¨çš„ç›¸å¯¹è¯¯å·®å°äºä¸‡åˆ†ä¹‹ä¸‰ã€‚ç”¨äºå¼¹é“åˆ†æã€å†å…¥åˆ†æã€åˆ¶å¯¼ã€æ°”åŠ¨åŠ›ç­‰çš„è®¡ç®—,èƒ½èŠ‚çœæœºæ—¶å’Œå†…å­˜ã€‚æ›´ä¾¿äºåœ¨è¢–çè®¡ç®—æœºä¸Šä½¿ç”¨
#      è€ƒè™‘é‡åŠ›åœºéšé«˜åº¦å˜åŒ–é€ æˆçš„å½±å“ï¼Œå¼•å…¥é‡åŠ›ä½åŠ¿é«˜åº¦ Hï¼Œæ›¿å‡ ä½•é«˜åº¦ Zï¼Œ
#      é€‚ç”¨äº-5-91kmï¼Œè‹¥è¶…å‡ºæ­¤èŒƒå›´åˆ™å–æœ€è¿‘çš„è¾¹ç•Œå¯¹åº”çš„å€¼
#      è¾“å…¥å‡ ä½•é«˜åº¦ï¼ˆå•ä½ï¼šmï¼‰Hï¼Œè¾“å‡ºä¸ºå¯¹åº”çš„æ¸©åº¦ Tï¼ˆå•ä½ï¼šKï¼‰ã€å‹å¼º Pï¼ˆå•ä½ï¼šPaï¼‰ã€å¯†åº¦ Rhoï¼ˆå•ä½ï¼škg/m^3ï¼‰ã€å£°é€Ÿ Sï¼ˆå•ä½ï¼šm/s^2ï¼‰ã€å¼•åŠ›åŠ é€Ÿåº¦ Gï¼ˆåœ†çƒæ¨¡å‹ä¸‹ï¼Œå•ä½ï¼šm/s^2ï¼‰
# ğŸ”ºæ­¤æ–‡ä»¶ä¸ altã€Zç›¸å…³çš„é‡å‡å¯è½¬ä¸ºéçŸ©é˜µå½¢å¼çš„å˜é‡

import numpy as np
from VehSimuParams import environment_params


class AtmosphereModel:
    def __init__(self):
        # æµ·å¹³é¢å¤§æ°”å‚æ•°å€¼
        self.constants = environment_params.Constants()
        self.T_SL = self.constants.T_SL  # æ¸©åº¦ï¼Œå•ä½ï¼šK
        self.P_SL = self.constants.P_SL  # å‹å¼ºï¼Œå•ä½ï¼šPa
        self.Rho_SL = self.constants.Rho_SL  # å¯†åº¦ï¼Œå•ä½ï¼škg/m^3
        self.g_SL = self.constants.g0  # å¼•åŠ›åŠ é€Ÿåº¦ï¼Œå•ä½ï¼šm/s^2
        self.a_SL = self.constants.a_SL  # å£°é€Ÿï¼Œå•ä½ï¼šm/s
        self.R0 = 6.356766 * 10 ** 3  # åœ°çƒåŠå¾„ï¼Œå•ä½ï¼škm   #æ³¨ï¼šæ­¤å¤„å’Œenvironment_paramä¸­å‚æ•°æœ‰å‡ºå…¥ éåœ†çƒæ¨¡å‹
        # self.R0 = self.constants.R0

    def get_atmosphere_params(self, alt):
        Z = alt / 1000  # å‡ ä½•é«˜åº¦ï¼Œå•ä½ï¼škm
        H = Z / (1 + Z / self.R0)  # é‡åŠ›ä½åŠ¿é«˜åº¦Hä¸å‡ ä½•é«˜åº¦Zçš„è½¬æ¢

        G = 9.80665 / (1 + Z / self.R0) ** 2  # å¼•åŠ›åŠ é€Ÿåº¦ï¼Œå•ä½ï¼šm/s^2

        W = np.zeros((1,1))

        # å˜é‡åˆå§‹åŒ–
        T, P, Rho, S = np.zeros_like(Z), np.zeros_like(Z), np.zeros_like(Z), np.zeros_like(Z)

        # æ£€æŸ¥é«˜åº¦èŒƒå›´
        if Z < -5 or Z > 91:
            print("ğŸ”ºè­¦å‘Šï¼é£è¡ŒèŒƒå›´è¶…å‡ºæ¨¡å‹èŒƒå›´..")
            pass  # è¶…å‡ºé€‚ç”¨èŒƒå›´ï¼Œä¸ºé˜²æ­¢ä»¿çœŸä¸­æ–­ï¼Œå–æœ€è¿‘å¯è¡Œå€¼

            # è£å‰ªé«˜åº¦
            Z = np.clip(Z, -5, 91)
            H = Z / (1 + Z / self.R0)  # é‡åŠ›ä½åŠ¿é«˜åº¦Hä¸å‡ ä½•é«˜åº¦Zçš„è½¬æ¢

            # æ ¹æ®å‡ ä½•é«˜åº¦åˆ’åˆ†
        if -5 <= Z <= 11.0191:
            W = 1 - H / 44.3308
            T = 288.15 * W  # æ¸©åº¦ï¼Œå•ä½ï¼šK
            P = W ** 5.2559 * self.P_SL  # å‹å¼ºï¼Œå•ä½ï¼šPa
            Rho = W ** 4.2559 * self.Rho_SL  # å¯†åº¦ï¼Œå•ä½ï¼škg/m^3
        elif 11.0191 < Z <= 20.0631:
            W = np.exp((14.9647 - H) / 6.3416)
            T = 216.650  # æ¸©åº¦ï¼Œå•ä½ï¼šK
            P = 1.1953 * 10 ** (-1) * W * self.P_SL  # å‹å¼ºï¼Œå•ä½ï¼šPa
            Rho = 1.5898 * 10 ** (-1) * W * self.Rho_SL  # å¯†åº¦ï¼Œå•ä½ï¼škg/m^3
        # ... waiting
        elif 20.0631 < Z <= 32.1619:
            W = 1 + (H - 24.9021) / 221.552
            T = 221.552 * W  # æ¸©åº¦ï¼Œå•ä½ï¼šK
            P = 2.5158e-3 * W ** (-34.1629) * self.P_SL  # å‹å¼ºï¼Œå•ä½ï¼šPa
            Rho = 3.2722e-2 * W ** (-35.1629) * self.Rho_SL  # å¯†åº¦ï¼Œå•ä½ï¼škg/m^3
        elif 32.1619 < Z <= 47.3501:
            W = 1 + (H - 39.7499) / 89.4107
            T = 250.350 * W  # æ¸©åº¦ï¼Œå•ä½ï¼šK
            P = 2.8338e-3 * W ** (-12.2011) * self.P_SL  # å‹å¼ºï¼Œå•ä½ï¼šPa
            Rho = 3.2618e-3 * W ** (-13.2011) * self.Rho_SL  # å¯†åº¦ï¼Œå•ä½ï¼škg/m^3
        elif 47.3501 < Z <= 51.4125:
            W = np.exp((48.6252 - H) / 7.9223)
            T = 270.650  # æ¸©åº¦ï¼Œå•ä½ï¼šK
            P = 8.9155e-4 * W * self.P_SL  # å‹å¼ºï¼Œå•ä½ï¼šPa
            Rho = 9.4920e-4 * W * self.Rho_SL  # å¯†åº¦ï¼Œå•ä½ï¼škg/m^3
        elif 51.4125 < Z <= 71.8020:
            W = 1 - (H - 59.4390) / 88.2218
            T = 247.021 * W  # æ¸©åº¦ï¼Œå•ä½ï¼šK
            P = 2.1671e-4 * W ** 12.2011 * self.P_SL  # å‹å¼ºï¼Œå•ä½ï¼šPa
            Rho = 2.5280e-4 * W ** 11.2011 * self.Rho_SL  # å¯†åº¦ï¼Œå•ä½ï¼škg/m^3
        elif 71.8020 < Z < 86.0000:
            W = 1 - (H - 78.0303) / 100.2950
            T = 200.590 * W  # æ¸©åº¦ï¼Œå•ä½ï¼šK
            P = 1.2274e-5 * W ** 17.0816 * self.P_SL  # å‹å¼ºï¼Œå•ä½ï¼šPa
            Rho = 1.7632e-5 * W ** 16.0816 * self.Rho_SL  # å¯†åº¦ï¼Œå•ä½ï¼škg/m^3
        elif 86.0000 <= Z <= 91.0000:
            W = np.exp((87.2848 - H) / 5.4700)
            T = 186.870  # æ¸©åº¦ï¼Œå•ä½ï¼šK
            P = (2.2730 + 1.042e-3 * H) * 1e-6 * W * self.P_SL  # å‹å¼ºï¼Œå•ä½ï¼šPa
            Rho = 3.6411e-6 * W * self.Rho_SL  # å¯†åº¦ï¼Œå•ä½ï¼škg/m^3

        # å£°é€Ÿä¸æ¸©åº¦æœ‰å…³
        S = 20.0468 * np.sqrt(T)  # å£°é€Ÿï¼Œå•ä½ï¼šm/s

        return T, P, Rho, S, G


# atm = AtmosphereModel()
# print(atm.get_atmosphere_params(50000))


# å‚è€ƒæ–‡çŒ®
# æ¨ç‚³å°‰.æ ‡å‡†å¤§æ°”å‚æ•°çš„å…¬å¼è¡¨ç¤º[J].å®‡èˆªå­¦æŠ¥, 1983(01):86-89.DOI:CNKI:SUN:YHXB.0.1983-01-009.
